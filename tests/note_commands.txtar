-- tmp-note1.txt --
Content of note1

-- tmp-note2.txt --
Content of note2

-- tmp-linked.txt --
See [[note1]] for reference

# Test note commands (list, print, resolve, move)
env EMX_NOTE_HOME=$WORK/.emx-notes
env EMX_AGENT_NAME=

# Create a capsa first
exec emx-note --home $WORK/.emx-notes -g capsa create test-notes
stdout 'Created capsa: test-notes'

# Create some notes using note command with stdin from files
exec emx-note --home $WORK/.emx-notes -c test-notes note note1 < $WORK/tmp-note1.txt
exec emx-note --home $WORK/.emx-notes -c test-notes note note2 < $WORK/tmp-note2.txt
exec emx-note --home $WORK/.emx-notes -c test-notes note linked < $WORK/tmp-linked.txt

# Test list command (lists note/ top-level files)
exec emx-note --home $WORK/.emx-notes -c test-notes list
stdout 'note1.md'
stdout 'note2.md'
stdout 'linked.md'

# Test print command
exec emx-note --home $WORK/.emx-notes -c test-notes print note2
stdout 'Content of note2'

# Test resolve command - should output full path
exec emx-note --home $WORK/.emx-notes -c test-notes resolve note1
stdout 'note1.md'

# Test resolve with non-existent note
! exec emx-note --home $WORK/.emx-notes -c test-notes resolve nonexistent
stderr 'not found'

# Test move command
exec emx-note --home $WORK/.emx-notes -c test-notes move note1.md renamed-note.md
stdout 'Moved'

# Verify move worked
! exists $WORK/.emx-notes/test-notes/note/note1.md
exists $WORK/.emx-notes/test-notes/note/renamed-note.md

# Verify links were updated
exec emx-note --home $WORK/.emx-notes -c test-notes print linked
stdout 'renamed-note'

# Test resolve after move - should find new path
exec emx-note --home $WORK/.emx-notes -c test-notes resolve renamed-note
stdout 'renamed-note.md'

# Verify we can delete a note using resolve + rm
exec emx-note --home $WORK/.emx-notes -c test-notes resolve note2 > $WORK/note2_path.txt
exec rm "$(cat $WORK/note2_path.txt)"

# Verify delete worked
! exists $WORK/.emx-notes/test-notes/note/note2.md
