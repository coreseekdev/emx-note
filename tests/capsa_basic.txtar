# Test capsa commands
env EMX_NOTE_HOME=$WORK/.emx-notes
env EMX_AGENT_NAME=

# List empty capsae
exec emx-note --home $WORK/.emx-notes -g capsa list
stdout 'none'

# Create a capsa (outputs path)
exec emx-note --home $WORK/.emx-notes -g capsa create test-capsa
stdout '.emx-notes/test-capsa'

# List should now show the capsa
exec emx-note --home $WORK/.emx-notes -g capsa list
stdout 'test-capsa'

# Resolve capsa path
exec emx-note --home $WORK/.emx-notes -g capsa resolve test-capsa
stdout 'test-capsa'

# Cannot create duplicate
! exec emx-note --home $WORK/.emx-notes -g capsa create test-capsa
stderr 'already exists'

# Cannot create with . prefix
! exec emx-note --home $WORK/.emx-notes -g capsa create .hidden
stderr 'reserved for system'

# Create a link capsa (outputs link file path)
exec mkdir $WORK/external-dir
exec emx-note --home $WORK/.emx-notes -g capsa create external-link $WORK/external-dir
stdout '.emx-notes/external-link'

# Resolve link capsa (outputs target path)
exec emx-note --home $WORK/.emx-notes -g capsa resolve external-link
stdout 'external-dir'
