# Test task list command
env EMX_NOTE_HOME=$WORK/.emx-notes
env EMX_AGENT_NAME=agent-1
env EMX_TASK_TIMESTAMP="2026-02-14 10:00"

# Setup: create tasks in different states
exec emx-note --home $WORK/.emx-notes -g capsa create test-task
exec emx-note --home $WORK/.emx-notes -c test-task daily "Test Note"
exec emx-note --home $WORK/.emx-notes -c test-task task add 100000

env EMX_TASK_TIMESTAMP="2026-02-14 15:00"
exec emx-note --home $WORK/.emx-notes -c test-task daily "Test Note 2"
exec emx-note --home $WORK/.emx-notes -c test-task task add 150000

env EMX_TASK_TIMESTAMP="2026-02-14 16:00"
exec emx-note --home $WORK/.emx-notes -c test-task daily "Test Note 3"
exec emx-note --home $WORK/.emx-notes -c test-task task add 160000

# TASK-01: doing (taken by agent-1)
exec emx-note --home $WORK/.emx-notes -c test-task task take TASK-01 --title "Active task"

# TASK-02: done
exec emx-note --home $WORK/.emx-notes -c test-task task take TASK-02 --title "Done task"
exec emx-note --home $WORK/.emx-notes -c test-task task release TASK-02 --done

# TASK-03: backlog (not taken)

# List all tasks
exec emx-note --home $WORK/.emx-notes -c test-task task list
stdout 'TASK-01'
stdout 'TASK-02'
stdout 'TASK-03'
stdout 'doing'
stdout 'done'
stdout 'backlog'

# List doing only
exec emx-note --home $WORK/.emx-notes -c test-task task list doing
stdout 'TASK-01'
! stdout 'TASK-02'
! stdout 'TASK-03'

# List done only
exec emx-note --home $WORK/.emx-notes -c test-task task list done
stdout 'TASK-02'
! stdout 'TASK-01'

# List backlog only
exec emx-note --home $WORK/.emx-notes -c test-task task list backlog
stdout 'TASK-03'
! stdout 'TASK-01'

# List with --oneline
exec emx-note --home $WORK/.emx-notes -c test-task task list doing --oneline
stdout '^TASK-01$'

# List with --owner filter
exec emx-note --home $WORK/.emx-notes -c test-task task list --owner @agent-1
stdout 'TASK-01'
! stdout 'TASK-02'

# List with owner=(none)
exec emx-note --home $WORK/.emx-notes -c test-task task list doing --owner '(none)'
! stdout 'TASK-01'
